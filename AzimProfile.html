<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Design</title>
    <style>
        body {
  margin: 0;
  background-color: #f2f6fc;
  font-family: Arial, sans-serif;
}

.container {
  display: flex;
  height: 100vh; /* Set the container height to 100% of the viewport */
}

.row-3 {
  display: flex;
  width: 100%;
}

.col-left-3 {
  width: 20%; /* Left section width */
  background-color: #000;
  color: #fff;
  padding: 20px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.col-right-3 {
  width: 75%; /* Right section width */
  padding: 20px;
  box-sizing: border-box;
  overflow-y: auto; /* Allow scrolling if content overflows */
}

.profile-picture-3 {
  width: 120px;
  height: 120px;
  background-color: #fff;
  border-radius: 50%;
  margin-bottom: 20px;
}

.name-3 {
  font-size: 1.2rem;
  margin-bottom: 30px;
}

.tab-button-3 {
  width: 100%;
  background-color: transparent;
  color: #fff;
  border: none;
  padding: 15px;
  text-align: left;
  font-size: 1rem;
  cursor: pointer;
  border-radius: 8px;
  margin-bottom: 10px;
}

.tab-button-3:hover {
  background-color: #333;
}

.card-3 {
  background: #fff;
  border-radius: 0.35rem;
  box-shadow: 0 0.15rem 1.75rem rgba(33, 40, 50, 0.15);
}

.card-header-3 {
  background-color: rgba(33, 40, 50, 0.03);
  border-bottom: 1px solid rgba(33, 40, 50, 0.125);
  padding: 1rem 1.35rem;
  font-weight: 500;
}

.card-body-3 {
  padding: 1rem 1.35rem;
}

.big_input-3 {
  width: 96%;
  padding: 10px;
  border-radius: 0.35rem;
  border: 1px solid #c5ccd6;
  font-size: 0.875rem;
  margin-bottom: 15px;
}

.form-group-3 {
  margin-bottom: 15px;
}

.form-control-3 {
  width: 85%;
  padding: 10px;
  border-radius: 0.35rem;
  border: 1px solid #c5ccd6;
  font-size: 0.875rem;
}

.save-edit-btn-3 {
  background-color: #3498db;
  color: white;
  border: none;
  padding: 10px 20px;
  font-size: 16px;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.save-edit-btn-3:hover {
  background-color: #2980b9;
}

.cancel-btn-3 {
  background-color: #d0e1f9;
  color: #0b4f6c;
  border: none;
  padding: 10px 20px;
  font-size: 16px;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.cancel-btn-3:hover {
  background-color: #b0cfe9;
  color: #0b4f6c;

}

/* Existing styles for left and right sections */
#change-password-section-3 {
  display: none;
}



/* Responsive Styles */
@media (max-width: 768px) {
  .container-3 {
    flex-direction: column;
  }

  .form-group-3 {
    margin-bottom: 20px;
  }

  .row-3 {
    flex-direction: column;
  }

  .form-group.col-3 {
    width: 100%;
  }

  .form-group.col-3:nth-child(1) {
    margin-bottom: 0;
  }

  .form-group.col-3:last-child {
    margin-top: 20px;
  }

  .form-control-3 {
    width: 96%;
  }
  
  .col-left-3 {
    width: 100%;
    height: auto;
    padding: 10px;
  }

  .col-right-3 {
    width: 100%;
    height: auto;
    padding: 10px;
  }

  .tab-button-3 {
    text-align: center;
  }

  .btn-3 {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
  }
}

@media (max-width: 576px) {
  .profile-picture-3 {
    width: 80px;
    height: 80px;
  }

  .tab-button-3 {
    font-size: 0.9rem;
    padding: 10px;
  }

  .btn-3 {
    padding: 12px;
  }

  .form-group-3 {
    margin-bottom: 20px;
  }
}
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <!-- Left Section -->
        <div class="col-left">
          <h2>Profile Picture</h2>
          <div class="profile-picture"></div>
          <div class="name">Your Name</div>
          <button class="tab-button" id="dashboardButton">Dashboard</button>
          <button class="tab-button" id="changePasswordButton">
            Change Password
          </button>
        </div>

        <!-- Right Section -->
        <div class="col-right">
          <!-- Account Details Form -->
          <div id="accountDetails">
            <div class="card details-card">
              <div class="card-header">Account Details</div>
              <div class="card-body">
                <form>
                  <!-- Form Group (username)-->
                  <div class="form-group">
                    <label for="inputUsername">Username</label>
                    <input
                      class="big_input"
                      id="inputUsername"
                      type="text"
                      placeholder="Enter your username"
                    />
                  </div>
                  <!-- Form Row -->
                  <div class="row">
                    <!-- Form Group (first name)-->
                    <div class="form-group col">
                      <label for="inputFirstName">First name</label>
                      <input
                        class="form-control"
                        id="inputFirstName"
                        type="text"
                        placeholder="Enter your first name"
                      />
                    </div>
                    <!-- Form Group (last name)-->
                    <div class="form-group col">
                      <label for="inputLastName">Last name</label>
                      <input
                        class="form-control"
                        id="inputLastName"
                        type="text"
                        placeholder="Enter your last name"
                      />
                    </div>
                  </div>
                  <!-- Form Group (location)-->
                  <div class="form-group">
                    <label for="inputLocation">Location</label>
                    <input
                      class="big_input"
                      id="inputLocation"
                      type="text"
                      placeholder="Enter your location"
                    />
                  </div>
                  <!-- Form Group (email address)-->
                  <div class="form-group">
                    <label for="inputEmailAddress">Email address</label>
                    <input
                      class="big_input"
                      id="inputEmailAddress"
                      type="email"
                      placeholder="Enter your email address"
                    />
                  </div>
                  <!-- Form Group (phone number)-->
                  <div class="form-group">
                    <label for="inputPhone">Phone number</label>
                    <input
                      class="big_input"
                      id="inputPhone"
                      type="tel"
                      placeholder="Enter your phone number"
                    />
                  </div>
                  <!-- Save changes and Edit buttons -->
                  <button
                    class="btn save-edit-btn"
                    type="button"
                    id="saveEditButton"
                  >
                    Edit
                  </button>
                </form>
              </div>
            </div>
          </div>

          <!-- Change Password Form -->
          <div id="changePasswordForm" style="display: none">
            <div class="card details-card">
              <div class="card-header">Change Password</div>
              <div class="card-body">
                <form>
                  <!-- Old Password -->
                  <div class="form-group">
                    <label for="inputOldPassword">Old Password</label>
                    <input
                      class="big_input"
                      id="inputOldPassword"
                      type="password"
                      placeholder="Enter your old password"
                    />
                  </div>
                  <!-- New Password -->
                  <div class="form-group">
                    <label for="inputNewPassword">New Password</label>
                    <input
                      class="big_input"
                      id="inputNewPassword"
                      type="password"
                      placeholder="Enter your new password"
                    />
                  </div>
                  <!-- Confirm New Password -->
                  <div class="form-group">
                    <label for="inputConfirmPassword"
                      >Confirm New Password</label
                    >
                    <input
                      class="big_input"
                      id="inputConfirmPassword"
                      type="password"
                      placeholder="Confirm your new password"
                    />
                  </div>
                  <!-- Submit and Cancel buttons -->
                  <button
                    class="btn save-edit-btn"
                    type="button"
                    id="submitPassword"
                  >
                    Submit
                  </button>
                  <button class="btn cancel-btn" type="button" id="cancelPassword">
                    Cancel
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>

document.addEventListener("DOMContentLoaded", function () {
  const profileUrl = "http://52.66.205.5:8000/profile-user/";
  const updateProfileUrl = "http://52.66.205.5:8000/update-profile-user/";
  const changePasswordUrl = "http://52.66.205.5:8000/change-password/";
  const token = localStorage.getItem('accessToken')

  // Fetch profile information on page load
  fetch(profileUrl, {
    method: "GET",
    headers: {
      "Authorization": `Bearer ${token}`,
      "Content-Type": "application/json"
    }
  })
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.json();
    })
    .then((data) => {
      console.log("Profile Information:", data);
      document.getElementById("inputUsername").value = data.username || "";
      document.getElementById("inputEmailAddress").value = data.email || "";
      document.getElementById("inputFirstName").value = data.name.split(" ")[0] || "";
      document.getElementById("inputLastName").value = data.name.split(" ")[1] || "";
      document.getElementById("inputPhone").value = data.phone_number || "";
      document.getElementById("inputLocation").value = data.address || "";
    })
    .catch((error) => {
      console.error("Failed to fetch profile information:", error);
    });

  // Elements
  const dashboardButton = document.getElementById("dashboardButton");
  const changePasswordButton = document.getElementById("changePasswordButton");
  const accountDetailsSection = document.getElementById("accountDetails");
  const changePasswordForm = document.getElementById("changePasswordForm");
  const saveEditButton = document.querySelector(".save-edit-btn");
  const submitPasswordButton = document.getElementById("submitPassword");
  const cancelPasswordButton = document.getElementById("cancelPassword");
  const formElements = document.querySelectorAll("#accountDetails input");
  const passwordFormElements = document.querySelectorAll("#changePasswordForm input");

  let isEditMode = false; // To track whether we are in edit mode

  // Function to toggle the readonly attribute on form fields
  const toggleFormEditable = (editable) => {
    formElements.forEach((input) => {
      input.readOnly = !editable;
    });
  };

  // Show account details form
  const showAccountDetails = () => {
    accountDetailsSection.style.display = "block";
    changePasswordForm.style.display = "none";
    toggleFormEditable(false);
    saveEditButton.textContent = "Edit"; // Set button to "Edit"
    isEditMode = false; // Exit edit mode
  };

  // Show change password form
  const showChangePasswordForm = () => {
    accountDetailsSection.style.display = "none";
    changePasswordForm.style.display = "block";
  };

  // Save profile data to the API
  const saveProfileData = () => {
    const updatedProfile = {
      username: document.getElementById("inputUsername").value,
      email: document.getElementById("inputEmailAddress").value,
      name: `${document.getElementById("inputFirstName").value} ${document.getElementById("inputLastName").value}`,
      phone_number: document.getElementById("inputPhone").value,
      address: document.getElementById("inputLocation").value
    };

    fetch(updateProfileUrl, {
      method: "PUT",
      headers: {
        Authorization: `Bearer ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify(updatedProfile)
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then((data) => {
        console.log("Profile Updated:", data);
        alert("Profile updated successfully!");
        toggleFormEditable(false);
        saveEditButton.textContent = "Edit"; // Change button to "Edit"
        isEditMode = false; // Exit edit mode
      })
      .catch((error) => {
        console.error("Failed to update profile information:", error);
        alert("Failed to update profile. Please try again.");
      });
  };

  // Change password function
  const changePassword = () => {
    const currentPassword = document.getElementById("inputOldPassword").value;
    const newPassword = document.getElementById("inputNewPassword").value;
    const confirmPassword = document.getElementById("inputConfirmPassword").value;
  
    if (newPassword !== confirmPassword) {
      alert('New passwords do not match.');
      return;
    }
  
    fetch(changePasswordUrl, {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        current_password: currentPassword,  // API expects "current_password"
        new_password: newPassword           // API expects "new_password"
      })
    })
    .then(response => {
      if (!response.ok) {
        return response.json().then(errData => {
          console.error('Failed to change password:', errData);
          alert(errData.error || 'Failed to change password.');
          throw new Error(`HTTP error! status: ${response.status}`);
        });
      }
      return response.json();
    })
    .then(data => {
      console.log("Password Changed:", data);
      alert('Password changed successfully!');
      showAccountDetails();
    })
    .catch(error => {
      console.error("Failed to change password:", error);
      alert('Failed to change password. Please try again.');
    });
  };
  
  // Cancel password change and clear the input fields
  const cancelPasswordChange = () => {
    document.getElementById("inputOldPassword").value = "";
    document.getElementById("inputNewPassword").value = "";
    document.getElementById("inputConfirmPassword").value = "";
  };

  // Toggle button functionality for Save/Edit
  saveEditButton.addEventListener("click", () => {
    if (isEditMode) {
      // If in edit mode, save the profile data
      saveProfileData();
    } else {
      // If not in edit mode, enable editing
      toggleFormEditable(true);
      saveEditButton.textContent = "Save"; // Change button to "Save"
      isEditMode = true; // Enter edit mode
    }
  });

  // Event listeners for buttons
  dashboardButton.addEventListener("click", showAccountDetails);
  changePasswordButton.addEventListener("click", showChangePasswordForm);
  submitPasswordButton.addEventListener("click", changePassword);
  cancelPasswordButton.addEventListener("click", cancelPasswordChange);

  // Show account details form by default
  showAccountDetails();
});
    </script>
  </body>
</html>